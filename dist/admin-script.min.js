import{StorageKeys}from"./types.js";import{debounce,SafeStorage,DOMUtils,AnimationUtils,ImageUtils,ValidationUtils,PerformanceUtils,FormatUtils}from"./utils.js";class AdminApp{constructor(){this.portfolioData=[];this.productsData=[];this.currentUser=null;this.cropper=null;this.currentImageTarget="portfolio";this.currentEditingId=null;this.isInitialized=false;this.thumbnailSizes=[];this.tempImageData={};this.elements={};this.siteSettings=this.getDefaultSettings();this.thumbnailSizes=this.getDefaultThumbnailSizes();this.bindMethods()}bindMethods(){this.handleTabSwitch=this.handleTabSwitch.bind(this);this.handleFormSubmit=this.handleFormSubmit.bind(this);this.handleImageUpload=this.handleImageUpload.bind(this);this.handleCropperSave=this.handleCropperSave.bind(this);this.handleDeleteItem=this.handleDeleteItem.bind(this);this.handleEditItem=this.handleEditItem.bind(this);this.handleLogin=this.handleLogin.bind(this);this.handleLogout=this.handleLogout.bind(this);this.showProductModal=this.showProductModal.bind(this);this.closeProductModal=this.closeProductModal.bind(this);this.showPortfolioModal=this.showPortfolioModal.bind(this);this.closePortfolioModal=this.closePortfolioModal.bind(this)}async init(){if(this.isInitialized)return;PerformanceUtils.mark("admin-init-start");try{this.cacheElements();this.checkAuthStatus();await this.loadData();this.setupEventListeners();await this.renderContent();this.setupFormValidation();this.setupImageHandlers();this.isInitialized=true;PerformanceUtils.measure("Admin Initialization","admin-init-start");console.log("🔧 Admin panel initialized with TypeScript!")}catch(error){console.error("❌ Failed to initialize admin panel:",error);this.showMessage("Failed to load admin panel","error")}}cacheElements(){this.elements={portfolioGrid:DOMUtils.getElementById("portfolioList"),productsGrid:DOMUtils.getElementById("productsList"),cropperModal:DOMUtils.getElementById("cropperModal"),cropperImage:DOMUtils.getElementById("cropperImage"),profileImage:DOMUtils.getElementById("profileImage"),tabButtons:DOMUtils.querySelectorAll(".nav-tab"),tabContents:DOMUtils.querySelectorAll(".tab-content"),forms:DOMUtils.querySelectorAll("form")}}async loadData(){PerformanceUtils.mark("admin-data-load-start");this.portfolioData=SafeStorage.get(StorageKeys.PORTFOLIO_DATA,this.getDefaultPortfolio());this.productsData=SafeStorage.get(StorageKeys.PRODUCTS_DATA,this.getDefaultProducts());this.siteSettings=SafeStorage.get(StorageKeys.SITE_SETTINGS,this.getDefaultSettings());this.currentUser=SafeStorage.get(StorageKeys.USER_DATA,null);if(!SafeStorage.get(StorageKeys.PORTFOLIO_DATA,null)){SafeStorage.set(StorageKeys.PORTFOLIO_DATA,this.portfolioData)}if(!SafeStorage.get(StorageKeys.PRODUCTS_DATA,null)){SafeStorage.set(StorageKeys.PRODUCTS_DATA,this.productsData)}if(!SafeStorage.get(StorageKeys.SITE_SETTINGS,null)){SafeStorage.set(StorageKeys.SITE_SETTINGS,this.siteSettings)}PerformanceUtils.measure("Admin Data Loading","admin-data-load-start")}setupEventListeners(){const loginForm=DOMUtils.getElementById("loginForm");if(loginForm){loginForm.addEventListener("submit",this.handleLogin)}const logoutBtn=DOMUtils.getElementById("logoutBtn");if(logoutBtn){logoutBtn.addEventListener("click",this.handleLogout)}if(this.elements.tabButtons){DOMUtils.addEventListeners(this.elements.tabButtons,"click",this.handleTabSwitch)}if(this.elements.forms){this.elements.forms.forEach(form=>{form.addEventListener("submit",this.handleFormSubmit)})}const imageInputs=DOMUtils.querySelectorAll('input[type="file"]');DOMUtils.addEventListeners(imageInputs,"change",this.handleImageUpload);this.setupCropperHandlers();document.addEventListener("keydown",this.handleKeyboardShortcuts.bind(this));this.setupAutoSave();this.setupProductModalHandlers();this.setupPortfolioModalHandlers();this.setupEventDelegation()}setupEventDelegation(){document.addEventListener("click",event=>{const target=event.target;if(target.classList.contains("edit-btn")||target.closest(".edit-btn")){const button=target.classList.contains("edit-btn")?target:target.closest(".edit-btn");if(button){this.handleEditItem(event,button)}}if(target.classList.contains("delete-btn")||target.closest(".delete-btn")){const button=target.classList.contains("delete-btn")?target:target.closest(".delete-btn");if(button){this.handleDeleteItem(event,button)}}})}setupCropperHandlers(){const cropperModal=this.elements.cropperModal;if(!cropperModal)return;const saveBtn=cropperModal.querySelector(".cropper-save");saveBtn?.addEventListener("click",this.handleCropperSave);const cancelBtn=cropperModal.querySelector(".cropper-cancel");cancelBtn?.addEventListener("click",()=>this.closeCropperModal());const overlay=cropperModal.querySelector(".modal-overlay");overlay?.addEventListener("click",()=>this.closeCropperModal())}setupProductModalHandlers(){const modal=DOMUtils.getElementById("productModal");const closeBtn=DOMUtils.getElementById("closeProductModal");const cancelBtn=DOMUtils.getElementById("cancelProductModal");const addBtn=DOMUtils.getElementById("addProductBtn");if(closeBtn){closeBtn.addEventListener("click",this.closeProductModal.bind(this))}if(cancelBtn){cancelBtn.addEventListener("click",this.closeProductModal.bind(this))}if(addBtn){addBtn.addEventListener("click",this.showProductModal.bind(this))}if(modal){modal.addEventListener("click",e=>{if(e.target===modal)this.closeProductModal()})}}setupPortfolioModalHandlers(){const modal=DOMUtils.getElementById("portfolioModal");const closeBtn=DOMUtils.getElementById("closePortfolioModal");const cancelBtn=DOMUtils.getElementById("cancelPortfolioModal");const addBtn=DOMUtils.getElementById("addPortfolioBtn");if(closeBtn){closeBtn.addEventListener("click",this.closePortfolioModal.bind(this))}if(cancelBtn){cancelBtn.addEventListener("click",this.closePortfolioModal.bind(this))}if(addBtn){addBtn.addEventListener("click",this.showPortfolioModal.bind(this))}if(modal){modal.addEventListener("click",e=>{if(e.target===modal)this.closePortfolioModal()})}}setupFormValidation(){const forms=this.elements.forms;if(!forms)return;forms.forEach(form=>{const inputs=form.querySelectorAll("input, textarea, select");inputs.forEach(input=>{input.addEventListener("blur",()=>this.validateField(input));input.addEventListener("input",debounce(()=>this.validateField(input),300))})})}setupImageHandlers(){const profileImage=this.elements.profileImage;if(profileImage){const editBtn=document.querySelector(".edit-profile-image");editBtn?.addEventListener("click",()=>this.editProfileImage())}const imageInputs=DOMUtils.querySelectorAll('input[type="file"][accept*="image"]');imageInputs.forEach(input=>{input.addEventListener("change",e=>this.previewImage(e.target))});this.setupAdditionalImageHandlers()}setupAdditionalImageHandlers(){for(let i=1;i<=3;i++){const fileInput=DOMUtils.getElementById(`additionalImage${i}`);const urlInput=DOMUtils.getElementById(`additionalImageUrl${i}`);if(fileInput){fileInput.addEventListener("change",e=>{this.handleAdditionalImageUpload(e,i)})}if(urlInput){urlInput.addEventListener("change",e=>{const target=e.target;if(target.value){this.showAdditionalImagePreview(target.value,i)}})}}const removeButtons=DOMUtils.querySelectorAll(".remove-additional-image");removeButtons.forEach(button=>{button.addEventListener("click",e=>{const target=e.target;const index=parseInt(target.dataset.index||"0");if(index>0){this.removeAdditionalImage(index)}})})}async handleAdditionalImageUpload(event,index){const input=event.target;const file=input.files?.[0];if(!file)return;try{const imageUrl=await ImageUtils.fileToDataURL(file);const urlInput=DOMUtils.getElementById(`additionalImageUrl${index}`);if(urlInput){urlInput.value=imageUrl;this.showAdditionalImagePreview(imageUrl,index)}}catch(error){this.showMessage("Error uploading additional image","error")}}showAdditionalImagePreview(imageUrl,index){const preview=DOMUtils.getElementById(`additionalPreview${index}`);if(preview){const img=preview.querySelector("img");if(img){img.src=imageUrl;preview.style.display="block"}}}removeAdditionalImage(index){const preview=DOMUtils.getElementById(`additionalPreview${index}`);const urlInput=DOMUtils.getElementById(`additionalImageUrl${index}`);const fileInput=DOMUtils.getElementById(`additionalImage${index}`);if(preview)preview.style.display="none";if(urlInput)urlInput.value="";if(fileInput)fileInput.value=""}setupAutoSave(){const autoSaveInterval=3e4;setInterval(()=>{this.autoSave()},autoSaveInterval);window.addEventListener("beforeunload",()=>{this.saveAllData()})}async renderContent(){PerformanceUtils.mark("admin-render-start");await Promise.all([this.renderPortfolioItems(),this.renderProductItems(),this.loadSettings(),this.updateStatistics()]);PerformanceUtils.measure("Admin Content Rendering","admin-render-start")}async renderPortfolioItems(){const container=this.elements.portfolioGrid;if(!container)return;container.innerHTML="";if(this.portfolioData.length===0){container.innerHTML='<div class="empty-state">No portfolio items yet. Add your first item!</div>';return}const fragment=document.createDocumentFragment();for(const item of this.portfolioData){const card=this.createPortfolioAdminCard(item);fragment.appendChild(card)}container.appendChild(fragment)}createPortfolioAdminCard(item){const card=DOMUtils.createElement("div","portfolio-item");card.innerHTML=`\n      <div class="item-image">\n        <img src="${item.thumbnail||item.image}" alt="${item.title}" loading="lazy">\n      </div>\n      <div class="item-content">\n        <h4 class="item-title">${item.title}</h4>\n        <p class="item-description">${item.description||"Tidak ada deskripsi"}</p>\n        <div class="item-meta">\n          <span class="item-category">${this.getCategoryName(item.category)}</span>\n          <span class="item-status status-${item.status||"active"}">\n            ${(item.status||"active").toUpperCase()}\n          </span>\n        </div>\n        <div class="item-actions">\n          <button class="btn btn-small btn-primary edit-btn" data-id="${item.id}" data-type="portfolio">\n            <i class="fas fa-edit"></i> Edit\n          </button>\n          <button class="btn btn-small btn-danger delete-btn" data-id="${item.id}" data-type="portfolio">\n            <i class="fas fa-trash"></i> Delete\n          </button>\n        </div>\n      </div>\n    `;return card}async renderProductItems(){const container=this.elements.productsGrid;if(!container)return;container.innerHTML="";if(this.productsData.length===0){container.innerHTML='<div class="empty-state">No products yet. Add your first product!</div>';return}const fragment=document.createDocumentFragment();for(const product of this.productsData){const card=this.createProductAdminCard(product);fragment.appendChild(card)}container.appendChild(fragment)}createProductAdminCard(product){const card=DOMUtils.createElement("div","product-item");let priceDisplay=FormatUtils.formatPrice(product.price);if(product.originalPrice&&product.discount&&product.discount>0){priceDisplay=`\n        <div class="price-container">\n          <span class="original-price">${FormatUtils.formatPrice(product.originalPrice)}</span>\n          <span class="current-price">${FormatUtils.formatPrice(product.price)}</span>\n          <span class="discount-badge">-${product.discount}%</span>\n        </div>\n      `}const categoryDisplay=product.category?`<span class="item-category">${this.getCategoryDisplayName(product.category)}</span>`:"";const typeDisplay=product.type?`<span class="item-type ${product.type}">${product.type.toUpperCase()}</span>`:"";card.innerHTML=`\n      <div class="item-image">\n        <img src="${product.image}" alt="${product.name}" loading="lazy">\n        ${product.discount&&product.discount>0?`<div class="discount-overlay">-${product.discount}%</div>`:""}\n      </div>\n      <div class="item-content">\n        <h4 class="item-title">${product.name}</h4>\n        <p class="item-description">${product.description}</p>\n        <div class="item-price">${priceDisplay}</div>\n        <div class="item-meta">\n          ${categoryDisplay}\n          ${typeDisplay}\n          <span class="item-status status-${product.status}">\n            ${product.status.toUpperCase()}\n          </span>\n        </div>\n        <div class="item-actions">\n          <button class="btn btn-small btn-primary edit-btn" data-id="${product.id}" data-type="product">\n            <i class="fas fa-edit"></i> Edit\n          </button>\n          <button class="btn btn-small btn-danger delete-btn" data-id="${product.id}" data-type="product">\n            <i class="fas fa-trash"></i> Delete\n          </button>\n          ${product.downloadLink?`<button class="btn btn-small btn-success download-btn" onclick="window.open('${product.downloadLink}', '_blank')">\n            <i class="fas fa-download"></i> Download\n          </button>`:""}\n        </div>\n      </div>\n    `;return card}async loadSettings(){const{siteName:siteName,heroTitle:heroTitle,heroSubtitle:heroSubtitle,aboutText:aboutText,whatsappNumber:whatsappNumber,profileImage:profileImage}=this.siteSettings;this.setFormValue("siteName",siteName);this.setFormValue("heroTitle",heroTitle);this.setFormValue("heroSubtitle",heroSubtitle);this.setFormValue("aboutText",aboutText);this.setFormValue("whatsappNumber",whatsappNumber);if(profileImage&&this.elements.profileImage){this.elements.profileImage.src=profileImage}}async updateStatistics(){const stats={totalPortfolio:this.portfolioData.length,totalProducts:this.productsData.length,activeProducts:this.productsData.filter(p=>p.status==="active").length,totalCategories:new Set(this.portfolioData.map(p=>p.category)).size};this.updateStatElement("totalPortfolio",stats.totalPortfolio);this.updateStatElement("totalProducts",stats.totalProducts);this.updateStatElement("activeProducts",stats.activeProducts);this.updateStatElement("totalCategories",stats.totalCategories)}handleLogin(event){event.preventDefault();const form=event.target;const formData=new FormData(form);const username=formData.get("username");const password=formData.get("password");if(username==="admin"&&password==="admin123"){this.currentUser={username:"admin",password:"admin123"};SafeStorage.set(StorageKeys.USER_DATA,this.currentUser);this.showDashboard();this.showMessage("Login berhasil!","success")}else{this.showMessage("Username atau password salah!","error")}}handleLogout(){this.currentUser=null;SafeStorage.remove(StorageKeys.USER_DATA);this.showLogin();this.showMessage("Logout berhasil!","success")}checkAuthStatus(){try{const item=localStorage.getItem(StorageKeys.USER_DATA);if(item){const savedUser=JSON.parse(item);this.currentUser=savedUser;this.showDashboard()}else{this.showLogin()}}catch(error){console.error("Error checking auth status:",error);this.showLogin()}}showLogin(){const loginModal=DOMUtils.getElementById("loginModal");const adminDashboard=DOMUtils.getElementById("adminDashboard");if(loginModal)DOMUtils.addClass(loginModal,"active");if(adminDashboard)DOMUtils.removeClass(adminDashboard,"active")}showDashboard(){const loginModal=DOMUtils.getElementById("loginModal");const adminDashboard=DOMUtils.getElementById("adminDashboard");if(loginModal)DOMUtils.removeClass(loginModal,"active");if(adminDashboard)DOMUtils.addClass(adminDashboard,"active");this.renderPortfolioItems();this.renderProductItems();this.loadSettings()}handleTabSwitch(event,element){event.preventDefault();const targetTab=element.dataset.tab;if(!targetTab)return;this.elements.tabButtons?.forEach(btn=>DOMUtils.removeClass(btn,"active"));DOMUtils.addClass(element,"active");this.elements.tabContents?.forEach(content=>DOMUtils.removeClass(content,"active"));const targetContent=DOMUtils.getElementById(`${targetTab}Tab`);if(targetContent){DOMUtils.addClass(targetContent,"active")}this.loadTabData(targetTab)}async handleFormSubmit(event){event.preventDefault();const form=event.target;const formData=new FormData(form);const formType=form.dataset.type;try{switch(formType){case"portfolio":await this.handlePortfolioSubmit(formData);this.closePortfolioModal();break;case"product":await this.handleProductSubmit(formData);this.closeProductModal();break;case"settings":await this.handleSettingsSubmit(formData);break;default:throw new Error("Unknown form type")}this.showMessage("Data saved successfully!","success");form.reset()}catch(error){console.error("Form submission error:",error);this.showMessage("Failed to save data","error")}}async handlePortfolioSubmit(formData){const portfolioItem={title:formData.get("title"),category:formData.get("category"),description:formData.get("description"),status:formData.get("status")||"active"};const imageInput=DOMUtils.getElementById("portfolioImage");const imageUrl=this.tempImageData.portfolio||imageInput?.value||"";const additionalImageUrls=[];for(let i=1;i<=3;i++){const urlInput=DOMUtils.getElementById(`additionalImageUrl${i}`);if(urlInput?.value){additionalImageUrls.push(urlInput.value)}}if(!portfolioItem.title||!portfolioItem.category){throw new Error("Title and category are required")}if(this.currentEditingId){const index=this.portfolioData.findIndex(item=>item.id===this.currentEditingId);if(index!==-1){const existingItem=this.portfolioData[index];if(existingItem){this.portfolioData[index]={...existingItem,...portfolioItem,image:imageUrl||existingItem.image,additionalImages:additionalImageUrls,id:existingItem.id}}}this.currentEditingId=null}else{const newItem={...portfolioItem,id:this.generateId(),image:imageUrl||ImageUtils.createPlaceholder(400,300,portfolioItem.title||"Portfolio Item"),additionalImages:additionalImageUrls};this.portfolioData.push(newItem)}delete this.tempImageData.portfolio;await this.savePortfolioData();await this.renderPortfolioItems()}async handleProductSubmit(formData){const price=parseInt(formData.get("price"));const originalPrice=formData.get("originalPrice")?parseInt(formData.get("originalPrice")):undefined;const discount=formData.get("discount")?parseInt(formData.get("discount")):undefined;let calculatedDiscount=discount;if(originalPrice&&originalPrice>price){calculatedDiscount=Math.round((originalPrice-price)/originalPrice*100)}const productItem={name:formData.get("name"),description:formData.get("description"),price:price,status:formData.get("status")||"active"};if(originalPrice!==undefined){productItem.originalPrice=originalPrice}if(calculatedDiscount!==undefined){productItem.discount=calculatedDiscount}if(formData.get("category")){productItem.category=formData.get("category")}if(formData.get("type")){productItem.type=formData.get("type")}if(formData.get("downloadLink")){productItem.downloadLink=formData.get("downloadLink")}const imageInput=DOMUtils.getElementById("productImage");const imageUrl=this.tempImageData.product||imageInput?.value||"";if(!productItem.name||!productItem.price){throw new Error("Name and price are required")}if(this.currentEditingId){const index=this.productsData.findIndex(item=>item.id===this.currentEditingId);if(index!==-1){const existingItem=this.productsData[index];if(existingItem){this.productsData[index]={...existingItem,...productItem,image:imageUrl||existingItem.image,id:existingItem.id}}}this.currentEditingId=null}else{const newItem={...productItem,id:this.generateId(),image:imageUrl||ImageUtils.createPlaceholder(300,200,productItem.name||"Product")};this.productsData.push(newItem)}delete this.tempImageData.product;await this.saveProductsData();await this.renderProductItems()}async handleSettingsSubmit(formData){const settings={siteName:formData.get("siteName"),heroTitle:formData.get("heroTitle"),heroSubtitle:formData.get("heroSubtitle"),aboutText:formData.get("aboutText"),whatsappNumber:formData.get("whatsappNumber"),gridLayout:formData.get("gridLayout"),itemsPerPage:parseInt(formData.get("itemsPerPage"))||9,showCategories:formData.get("showCategories")==="on",enableAnimations:formData.get("enableAnimations")==="on"};if(settings.whatsappNumber&&!ValidationUtils.isValidPhoneNumber(settings.whatsappNumber)){throw new Error("Invalid WhatsApp number format")}this.siteSettings={...this.siteSettings,...settings};await this.saveSiteSettings();this.showMessage("Pengaturan berhasil disimpan!","success")}async handleImageUpload(event,element){const file=element.files?.[0];if(!file)return;if(!ValidationUtils.isValidImageFile(file)){this.showMessage("Please select a valid image file","error");return}if(!ValidationUtils.isValidFileSize(file,5*1024*1024)){this.showMessage("File size must be less than 5MB","error");return}try{const imageUrl=await ImageUtils.fileToDataURL(file);const targetType=element.dataset.target;this.currentImageTarget=targetType||"portfolio";const useDirectly=await this.showConfirmDialog("Upload Gambar","Apakah Anda ingin menggunakan gambar ini langsung atau ingin mengeditnya terlebih dahulu?");if(useDirectly){if(this.currentImageTarget==="profile"){await this.applyCroppedImage(imageUrl)}else{this.tempImageData[this.currentImageTarget]=imageUrl;if(this.currentImageTarget==="portfolio"){this.updatePortfolioImagePreview(imageUrl)}else if(this.currentImageTarget==="product"){this.updateProductImagePreview(imageUrl)}}this.showMessage("Image uploaded successfully!","success")}else{this.showCropperModal(imageUrl)}}catch(error){console.error("Image upload error:",error);this.showMessage("Failed to process image","error")}}async handleCropperSave(){if(!this.cropper)return;try{const canvas=this.cropper.getCroppedCanvas({width:800,height:600,imageSmoothingEnabled:true,imageSmoothingQuality:"high"});const croppedImageUrl=canvas.toDataURL("image/jpeg",.9);await this.applyCroppedImage(croppedImageUrl);this.closeCropperModal();this.showMessage("Image updated successfully!","success")}catch(error){console.error("Cropper save error:",error);this.showMessage("Failed to save image","error")}}async handleDeleteItem(event,element){const id=parseInt(element.dataset.id||"0");const type=element.dataset.type;if(!id||!type)return;const confirmed=await this.showConfirmDialog("Delete Item",`Are you sure you want to delete this ${type} item? This action cannot be undone.`);if(!confirmed)return;try{if(type==="portfolio"){await this.deletePortfolioItem(id)}else{await this.deleteProductItem(id)}this.showMessage("Item deleted successfully!","success")}catch(error){console.error("Delete error:",error);this.showMessage("Failed to delete item","error")}}async handleEditItem(event,element){const id=parseInt(element.dataset.id||"0");const type=element.dataset.type;if(!id||!type)return;try{if(type==="portfolio"){await this.editPortfolioItem(id)}else{await this.editProductItem(id)}}catch(error){console.error("Edit error:",error);this.showMessage("Failed to load item for editing","error")}}handleKeyboardShortcuts(event){if(event.ctrlKey&&event.key==="s"){event.preventDefault();this.saveAllData();this.showMessage("Data saved!","success")}if(event.key==="Escape"){this.closeCropperModal()}}showCropperModal(imageUrl){const modal=this.elements.cropperModal;const image=this.elements.cropperImage;if(!modal||!image){console.error("Cropper modal elements not found");return}image.src=imageUrl;DOMUtils.addClass(modal,"active");this.initializeCropper()}closeCropperModal(){const modal=this.elements.cropperModal;if(!modal)return;DOMUtils.removeClass(modal,"active");if(this.cropper){this.cropper.destroy();this.cropper=null}}initializeCropper(){const image=this.elements.cropperImage;if(!image||typeof Cropper==="undefined"){console.error("Cropper not available or image element not found");return}const config=this.getCropperConfig();image.onload=()=>{this.cropper=new Cropper(image,config)}}getCropperConfig(){const baseConfig={aspectRatio:4/3,viewMode:1,dragMode:"move",autoCropArea:.8,responsive:true,restore:false,guides:true,center:true,highlight:false,cropBoxMovable:true,cropBoxResizable:true,toggleDragModeOnDblclick:false};switch(this.currentImageTarget){case"profile":return{...baseConfig,aspectRatio:1};case"product":return{...baseConfig,aspectRatio:3/2};case"portfolio":default:return{...baseConfig,aspectRatio:4/3}}}async applyCroppedImage(imageUrl){switch(this.currentImageTarget){case"profile":await this.updateProfileImage(imageUrl);break;case"portfolio":if(this.currentEditingId){await this.updatePortfolioImage(imageUrl)}else{this.tempImageData.portfolio=imageUrl;this.updatePortfolioImagePreview(imageUrl)}break;case"product":if(this.currentEditingId){await this.updateProductImage(imageUrl)}else{this.tempImageData.product=imageUrl;this.updateProductImagePreview(imageUrl)}break}}async updateProfileImage(imageUrl){this.siteSettings.profileImage=imageUrl;if(this.elements.profileImage){this.elements.profileImage.src=imageUrl}await this.saveSiteSettings()}async updatePortfolioImage(imageUrl){if(!this.currentEditingId)return;const item=this.portfolioData.find(p=>p.id===this.currentEditingId);if(item){item.image=imageUrl;item.thumbnail=await ImageUtils.createThumbnail(imageUrl,300,200);await this.savePortfolioData();await this.renderPortfolioItems()}}async updateProductImage(imageUrl){if(!this.currentEditingId)return;const item=this.productsData.find(p=>p.id===this.currentEditingId);if(item){item.image=imageUrl;await this.saveProductsData();await this.renderProductItems()}}updatePortfolioImagePreview(imageUrl){const previewImg=DOMUtils.getElementById("portfolioPreviewImg");const previewContainer=DOMUtils.getElementById("portfolioImagePreview");const imageInput=DOMUtils.getElementById("portfolioImage");if(previewImg)previewImg.src=imageUrl;if(previewContainer)previewContainer.style.display="block";if(imageInput)imageInput.value=imageUrl}updateProductImagePreview(imageUrl){const previewImg=DOMUtils.getElementById("productPreviewImg");const previewContainer=DOMUtils.getElementById("productImagePreview");const imageInput=DOMUtils.getElementById("productImage");if(previewImg)previewImg.src=imageUrl;if(previewContainer)previewContainer.style.display="block";if(imageInput)imageInput.value=imageUrl}editProfileImage(){const profileImage=this.elements.profileImage;const cropperImage=this.elements.cropperImage;const cropperModal=this.elements.cropperModal;if(!profileImage||!cropperImage||!cropperModal){this.showMessage("Profile image editing is not available","error");return}if(profileImage.src.startsWith("data:image/svg+xml")){this.showMessage("Please upload a profile image first","warning");return}this.currentImageTarget="profile";this.showCropperModal(profileImage.src)}async editPortfolioItem(id){const item=this.portfolioData.find(p=>p.id===id);if(!item)return;this.currentEditingId=id;this.setFormValue("title",item.title);this.setFormValue("category",item.category);this.setFormValue("description",item.description||"");this.setFormValue("status",item.status||"active");if(item.image){const imageInput=DOMUtils.getElementById("portfolioImage");if(imageInput)imageInput.value=item.image;this.updatePortfolioImagePreview(item.image)}for(let i=1;i<=3;i++){const urlInput=DOMUtils.getElementById(`additionalImageUrl${i}`);const preview=DOMUtils.getElementById(`additionalPreview${i}`);if(item.additionalImages&&item.additionalImages[i-1]){const imageUrl=item.additionalImages[i-1];if(urlInput&&imageUrl)urlInput.value=imageUrl;if(imageUrl)this.showAdditionalImagePreview(imageUrl,i)}else{if(urlInput)urlInput.value="";if(preview)preview.style.display="none"}}this.switchToTab("portfolio");const form=DOMUtils.querySelector('form[data-type="portfolio"]');if(form){form.scrollIntoView({behavior:"smooth"})}}async editProductItem(id){const item=this.productsData.find(p=>p.id===id);if(!item)return;this.currentEditingId=id;this.setFormValue("name",item.name);this.setFormValue("description",item.description);this.setFormValue("price",item.price.toString());this.setFormValue("originalPrice",item.originalPrice?.toString()||"");this.setFormValue("discount",item.discount?.toString()||"");this.setFormValue("category",item.category||"");this.setFormValue("type",item.type||"digital");this.setFormValue("downloadLink",item.downloadLink||"");this.setFormValue("status",item.status);this.switchToTab("products");const modal=DOMUtils.querySelector("#productModal");if(modal){modal.style.display="flex";const title=modal.querySelector("#productModalTitle");if(title)title.textContent="Edit Produk Digital"}}async deletePortfolioItem(id){const index=this.portfolioData.findIndex(item=>item.id===id);if(index===-1)return;this.portfolioData.splice(index,1);await this.savePortfolioData();await this.renderPortfolioItems();await this.updateStatistics()}async deleteProductItem(id){const index=this.productsData.findIndex(item=>item.id===id);if(index===-1)return;this.productsData.splice(index,1);await this.saveProductsData();await this.renderProductItems();await this.updateStatistics()}switchToTab(tabName){const tabButton=DOMUtils.querySelector(`[data-tab="${tabName}"]`);if(tabButton){tabButton.click()}}async loadTabData(tabName){switch(tabName){case"dashboard":await this.updateStatistics();break;case"portfolio":await this.renderPortfolioItems();break;case"products":await this.renderProductItems();break;case"settings":await this.loadSettings();break}}validateField(input){const value=input.value.trim();const type=input.type;const required=input.hasAttribute("required");let isValid=true;let errorMessage="";if(required&&!value){isValid=false;errorMessage="This field is required"}if(value&&!isValid){switch(type){case"email":isValid=ValidationUtils.isValidEmail(value);errorMessage="Please enter a valid email address";break;case"tel":isValid=ValidationUtils.isValidPhoneNumber(value);errorMessage="Please enter a valid phone number";break;case"url":isValid=ValidationUtils.isValidURL(value);errorMessage="Please enter a valid URL";break;case"number":const num=parseFloat(value);isValid=!isNaN(num)&&num>=0;errorMessage="Please enter a valid positive number";break}}DOMUtils.toggleClass(input,"invalid",!isValid);DOMUtils.toggleClass(input,"valid",isValid&&!!value);this.showFieldError(input,isValid?"":errorMessage);return isValid}showFieldError(input,message){let errorElement=input.parentElement?.querySelector(".field-error");if(!errorElement){errorElement=DOMUtils.createElement("div","field-error");input.parentElement?.appendChild(errorElement)}errorElement.textContent=message;DOMUtils.toggleClass(errorElement,"visible",!!message)}previewImage(input){const file=input.files?.[0];if(!file)return;const reader=new FileReader;reader.onload=e=>{const previewContainer=input.parentElement?.querySelector(".image-preview");if(previewContainer){previewContainer.innerHTML=`<img src="${e.target?.result}" alt="Preview">`}};reader.readAsDataURL(file)}async autoSave(){try{await this.saveAllData();console.log("📁 Auto-save completed")}catch(error){console.error("Auto-save failed:",error)}}async saveAllData(){await Promise.all([this.savePortfolioData(),this.saveProductsData(),this.saveSiteSettings()])}async savePortfolioData(){SafeStorage.set(StorageKeys.PORTFOLIO_DATA,this.portfolioData)}async saveProductsData(){SafeStorage.set(StorageKeys.PRODUCTS_DATA,this.productsData)}async saveSiteSettings(){SafeStorage.set(StorageKeys.SITE_SETTINGS,this.siteSettings)}setFormValue(name,value){const input=DOMUtils.querySelector(`[name="${name}"]`);if(input){input.value=value}}updateStatElement(id,value){const element=DOMUtils.getElementById(id);if(element){AnimationUtils.animateNumber(element,value,1e3)}}showMessage(message,type="info"){const messageContainer=DOMUtils.getElementById("messageContainer")||this.createMessageContainer();const messageElement=DOMUtils.createElement("div",`message message-${type}`);messageElement.innerHTML=`\n      <span class="message-text">${message}</span>\n      <button class="message-close">&times;</button>\n    `;const closeBtn=messageElement.querySelector(".message-close");closeBtn?.addEventListener("click",()=>{AnimationUtils.fadeOut(messageElement,300).then(()=>{messageElement.remove()})});messageContainer.appendChild(messageElement);setTimeout(()=>{if(messageElement.parentElement){AnimationUtils.fadeOut(messageElement,300).then(()=>{messageElement.remove()})}},5e3);AnimationUtils.fadeIn(messageElement,300)}createMessageContainer(){const container=DOMUtils.createElement("div","message-container");container.id="messageContainer";document.body.appendChild(container);return container}async showConfirmDialog(title,message){return new Promise(resolve=>{const dialog=this.createConfirmDialog(title,message,resolve);document.body.appendChild(dialog);requestAnimationFrame(()=>{DOMUtils.addClass(dialog,"active")})})}createConfirmDialog(title,message,callback){const dialog=DOMUtils.createElement("div","confirm-dialog");const isImageUpload=title==="Upload Gambar";const buttonsHtml=isImageUpload?`\n      <button class="btn btn-secondary dialog-cancel">Edit Gambar</button>\n      <button class="btn btn-primary dialog-confirm">Gunakan Langsung</button>\n    `:`\n      <button class="btn btn-secondary dialog-cancel">Cancel</button>\n      <button class="btn btn-danger dialog-confirm">Confirm</button>\n    `;dialog.innerHTML=`\n      <div class="dialog-overlay"></div>\n      <div class="dialog-content">\n        <h3 class="dialog-title">${title}</h3>\n        <p class="dialog-message">${message}</p>\n        <div class="dialog-actions">\n          ${buttonsHtml}\n        </div>\n      </div>\n    `;const closeDialog=result=>{DOMUtils.removeClass(dialog,"active");setTimeout(()=>{dialog.remove();callback(result)},300)};const cancelBtn=dialog.querySelector(".dialog-cancel");const confirmBtn=dialog.querySelector(".dialog-confirm");const overlay=dialog.querySelector(".dialog-overlay");cancelBtn?.addEventListener("click",()=>closeDialog(false));confirmBtn?.addEventListener("click",()=>closeDialog(true));overlay?.addEventListener("click",()=>closeDialog(false));return dialog}generateId(){const allIds=[...this.portfolioData.map(item=>item.id),...this.productsData.map(item=>item.id)];return Math.max(0,...allIds)+1}getCategoryName(category){const categoryNames={ilustrasi:"Ilustrasi",character:"Character Design",branding:"Branding",editorial:"Editorial"};return categoryNames[category]||category}getCategoryDisplayName(category){const categoryMap={brush:"Custom Brush",font:"Font",action:"Action Photoshop",texture:"Texture Pack",template:"Template",other:"Lainnya"};return categoryMap[category]||category}showProductModal(){const modal=DOMUtils.getElementById("productModal");if(modal){modal.style.display="flex";const form=modal.querySelector("form");if(form)form.reset();const title=modal.querySelector("#productModalTitle");if(title)title.textContent="Tambah Produk Digital";this.currentEditingId=null}}closeProductModal(){const modal=DOMUtils.getElementById("productModal");if(modal){modal.style.display="none";this.currentEditingId=null}}showPortfolioModal(){const modal=DOMUtils.getElementById("portfolioModal");if(modal){modal.style.display="flex";const form=modal.querySelector("form");if(form)form.reset();const title=modal.querySelector("#portfolioModalTitle");if(title)title.textContent="Tambah Karya Portfolio";this.currentEditingId=null}}closePortfolioModal(){const modal=DOMUtils.getElementById("portfolioModal");if(modal){modal.style.display="none";this.currentEditingId=null}}getDefaultPortfolio(){return[{id:1,title:"Digital Art Sample",category:"ilustrasi",image:ImageUtils.createPlaceholder(400,300,"Digital Art"),description:"Sample digital artwork",status:"active"}]}getDefaultProducts(){return[{id:1,name:"Sample Product",price:1e5,description:"Sample digital product",image:ImageUtils.createPlaceholder(300,200,"Product"),status:"active"}]}getDefaultSettings(){return{siteName:"Portfolio Admin",heroTitle:"Ilustrator & Desainer",heroSubtitle:"Menciptakan karya visual yang menginspirasi",whatsappNumber:"6281234567890",aboutText:"Professional illustrator and graphic designer with 5+ years of experience."}}getDefaultThumbnailSizes(){return[{name:"small",width:150,height:100},{name:"medium",width:300,height:200},{name:"large",width:600,height:400}]}}const adminApp=new AdminApp;if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>adminApp.init())}else{adminApp.init()}export default adminApp;export{AdminApp};